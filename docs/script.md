
# 直播计划脚本编写指南

## 脚本结构

脚本是yaml文件结构，是一系列任务的组合。

## 外层结构

最外层包含三个字段version、env和jobs。

| 字段      | 说明                                                     | 是否必填 | 默认值 | 示例        | 备注 | 
|---------|--------------------------------------------------------|------|-----|-----------|----|
| version | 配置文件的版本，目前只支持1                                         | 是    | 无   | version:1 |    |
| env     | 环境设置。下面会详细说明                                           | 否    | 无   |           |    |
| jobs    | 需要执行的任务定义，为字典类型，包含多种任务类型，并且可以嵌套。每个任务包含key、name、type等字段 | 是    | 无   |           |    |

env设置

| 字段                        | 说明                                        | 是否必填 | 默认值   | 示例 | 备注 | 
|---------------------------|-------------------------------------------|------|-------|----|----|
| loop                      | 是否循环                                      | 否    | False |    |    |
| loop_times                | 循环次数，开启loop时有效，值为 0 代表无限循环                | 否    | 0     |    |    |
| log                       | 是否启用日志                                    | 否    | True  |    |    |
| name                      | 为当前脚本或者计划起一个名称，不能包含空格，最好是英文，后续用于创建作用域，为必填 | 是    | 无     |    |    |
| enable_barrage_monitoring | 开启弹幕监听，开启此功能，后续才可以使用on_barrage_received字段 | 否    | False |    |    |



## 任务类型

**公共字段**

即每个任务都会包含的字段

| 字段                  | 说明                                                                                  | 是否必填 | 默认值 | 示例                                     | 备注             | 
|---------------------|-------------------------------------------------------------------------------------|------|-----|----------------------------------------|----------------|
| key                 | 任务id，注意这里填写为yaml的key                                                                | 是    | 无   |                                        |                |
| type                | 任务类型，目前支持以下任务类型：group：由一组任务组成的任务;audio：播放音频并驱动嘴型;interaction：互动任务;interval：等待若干秒的任务 | 是    | 无   | type: audio                            |                |
| name                | 任务名称                                                                                | 是    | 无   |                                        |                |
| value               | 值，任务不同，其代表的意义不同                                                                     | 否    | 无   |                                        |                |
| caption             | 字幕，即执行当前任务时，显示在数字人屏幕上的提示信息                                                          | 否    | 无   | caption: 开场白                           |                |
| background_music    | 背景音乐，可以填写快捷名称和文件路径。                                                                 | 否    | 无   | background_music: "c:/music/科技.mp3"    | 文件路径就是音频文件的路径。 |
| background_image    | 背景图片                                                                                | 否    | 无   | background_image: "c:/image/背景图片1.jpg" |                |
| on_barrage_received | 当当前任务接收到弹幕后需要执行的动作设置，较复杂，可以看下面的表格介绍                                                 |      |     |                                        |                |

#### on_barrage_received
| 字段          | 说明                                                                                                                | 是否必填 | 默认值                | 示例                                | 备注 | 
|-------------|-------------------------------------------------------------------------------------------------------------------|------|--------------------|-----------------------------------|----|
| action      | 执行的动作                                                                                                             | 是    | play_audio         | action: 'play_audio'              |    |
| opportunity | 动作执行的时机                                                                                                           | 是    | after_job_executed | opportunity: 'after_job_executed' |    |
| deep        | 解析的任务深度，如果为-1，则所有任务都可能响应此动作，如果为0，代表当前任务（不解析任何子任务），设置为正整数，那么会解析第n层的子任务（如果存在），例如这里设置为1，意为在每本图书执行完毕时，检查是否有弹幕然后执行相应操作 | 是    | 无                  |                                   |    |
| play_audio  | 如果action设置为 play_audio ，则需要配置此字段，此字段为一个AudioJob定义，参见下面的AudioJob                                                   | 否    | 无                  |                                   |    |


下面详细说明每个任务的字段

### GroupJob 组任务

| 字段   | 说明                 | 是否必填 | 默认值 | 示例 | 备注 | 
|------|--------------------|------|-----|----|----|
| jobs | 子任务列表，和外层的jobs含义一致 | 是    | 无   |    |    |


### AudioJob 音频任务

| 字段    | 说明              | 是否必填 | 默认值 | 示例 | 备注 | 
|-------|-----------------|------|-----|----|----|
| value | 需播放的文本，会自动转换为音频 | 是    | 无   |    |    |



### InteractionJob互动任务

| 字段                         | 说明                                 | 是否必填 | 默认值          | 示例                                                                                                                                     | 备注 | 
|----------------------------|------------------------------------|------|--------------|----------------------------------------------------------------------------------------------------------------------------------------|----|
| duration                   | 任务持续时长，单位秒                         | 是    | 1800         |                                                                                                                                        |    |
| idle_audios                | 空闲时的音频，默认随机播放，由多个AudioJob组成。       | 否    | 无            |                                                                                                                                        |    |
| idle_audio_play_mode       | 空闲时音频播放模式，random、order             | 否    | random       |                                                                                                                                        |    |
| idle_timing                | 空闲计时，单位秒，超过这个时间没有互动即任务空闲，则会播放空闲时音频 | 否    | 120          |                                                                                                                                        |    |
| idle_start_audio           | AudioJob，用于空闲开始时需要播放的音频定义          | 否    | 无            | <pre lang="yaml">idle_start_audio: <br/>  type: audio <br/>  name: 口播过程中答复评论衔接语-出 <br/>  value: 好了。感谢小伙伴们的讨论，欢迎在评论区留言讨论哦，现在我们继续。</pre> |
| idle_end_audio             | AudioJob，用于定义空闲结束时需要播放的音频定义        | 否    | 无            |                                                                                                                                        |    |


### IntervalJob等待任务

| 字段    | 说明       | 是否必填 | 默认值 | 示例 | 备注 | 
|-------|----------|------|-----|----|----|
| value | 等待时长，单位秒 | 否    | 0   |    |    |


